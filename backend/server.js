const express = require('express');
const cors = require('cors');
const fs = require('fs');
const path = require('path');

const app = express();
const PORT = 8080;

app.use(cors());
app.use(express.json());
app.use(express.static('public'));

// Load emoji dictionary
const emojiDict = JSON.parse(fs.readFileSync('./emoji-dictionary.json', 'utf8'));

// Translate text to emojis
app.post('/translate', (req, res) => {
  const { text } = req.body;
  
  if (!text) {
    return res.status(400).json({ error: 'Text is required' });
  }

  const words = text.toLowerCase().split(' ');
  const translated = words.map(word => {
    // Remove punctuation for lookup but preserve it
    const cleanWord = word.replace(/[^a-zA-Z0-9]/g, '');
    const punctuation = word.replace(/[a-zA-Z0-9]/g, '');
    
    // Special case: don't translate "I"
    if (cleanWord.toLowerCase() === 'i') {
      return 'I' + punctuation;
    }
    
    // Look up the clean word in lowercase in the dictionary
    const emoji = emojiDict[cleanWord.toLowerCase()];
    return emoji ? emoji + punctuation : word;
  });

  const result = translated.join(' ');
  
  // Analyze sentiment for teddy mood
  const positiveWords = ['happy', 'love', 'excited', 'party', 'win', 'cake', 'pizza', 'joy', 'smile', 'laugh', 'celebrate', 'amazing', 'wonderful', 'great', 'awesome', 'fantastic', 'perfect', 'beautiful', 'good', 'nice', 'fun', 'cool', 'sweet', 'kind', 'friendly', 'cheerful', 'delighted', 'thrilled', 'pleased', 'satisfied', 'grateful', 'thankful', 'blessed', 'lucky', 'proud', 'confident', 'optimistic', 'hopeful', 'peaceful', 'calm', 'relaxed', 'comfortable', 'cozy', 'warm', 'bright', 'sunny', 'fresh', 'clean', 'healthy', 'strong', 'energetic', 'active', 'successful', 'victorious', 'triumphant', 'accomplished', 'achieved', 'completed', 'finished', 'done', 'ready', 'prepared', 'organized', 'focused', 'determined', 'motivated', 'inspired', 'creative', 'innovative', 'brilliant', 'smart', 'clever', 'wise', 'intelligent', 'talented', 'skilled', 'gifted', 'special', 'unique', 'valuable', 'precious', 'loved', 'adored', 'cherished', 'appreciated', 'respected', 'admired', 'honored', 'celebrated', 'welcomed', 'accepted', 'included', 'supported', 'helped', 'assisted', 'encouraged', 'motivated', 'uplifted', 'boosted', 'enhanced', 'improved', 'upgraded', 'advanced', 'progressed', 'developed', 'grown', 'evolved', 'transformed', 'changed', 'renewed', 'refreshed', 'revitalized', 'rejuvenated', 'restored', 'healed', 'cured', 'fixed', 'repaired', 'solved', 'resolved', 'settled', 'concluded', 'ended', 'closed', 'finished', 'completed', 'accomplished', 'achieved', 'attained', 'reached', 'arrived', 'succeeded', 'won', 'conquered', 'overcame', 'defeated', 'beat', 'surpassed', 'exceeded', 'outperformed', 'outdid', 'outshined', 'outmatched', 'outplayed', 'outwitted', 'outsmarted', 'outmaneuvered', 'outran', 'outpaced', 'outworked', 'outperformed', 'excelled', 'shined', 'glowed', 'sparkled', 'dazzled', 'amazed', 'impressed', 'wowed', 'stunned', 'surprised', 'delighted', 'thrilled', 'excited', 'elated', 'ecstatic', 'overjoyed', 'jubilant', 'euphoric', 'blissful', 'content', 'satisfied', 'fulfilled', 'complete', 'whole', 'perfect', 'flawless', 'impeccable', 'excellent', 'outstanding', 'exceptional', 'remarkable', 'extraordinary', 'incredible', 'unbelievable', 'phenomenal', 'spectacular', 'magnificent', 'marvelous', 'wonderful', 'fabulous', 'fantastic', 'terrific', 'superb', 'splendid', 'glorious', 'divine', 'heavenly', 'angelic', 'blessed', 'sacred', 'holy', 'pure', 'innocent', 'clean', 'clear', 'transparent', 'honest', 'truthful', 'sincere', 'genuine', 'authentic', 'real', 'true', 'loyal', 'faithful', 'devoted', 'committed', 'dedicated', 'passionate', 'enthusiastic', 'eager', 'keen', 'interested', 'curious', 'fascinated', 'intrigued', 'captivated', 'enchanted', 'charmed', 'mesmerized', 'hypnotized', 'spellbound', 'bewitched', 'entranced', 'absorbed', 'engrossed', 'immersed', 'involved', 'engaged', 'participating', 'contributing', 'helping', 'assisting', 'supporting', 'backing', 'endorsing', 'approving', 'agreeing', 'consenting', 'accepting', 'embracing', 'welcoming', 'greeting', 'saluting', 'acknowledging', 'recognizing', 'appreciating', 'valuing', 'treasuring', 'prizing', 'cherishing', 'loving', 'adoring', 'worshipping', 'idolizing', 'revering', 'respecting', 'honoring', 'esteeming', 'admiring', 'praising', 'complimenting', 'flattering', 'congratulating', 'celebrating', 'cheering', 'applauding', 'clapping', 'whistling', 'shouting', 'screaming', 'yelling', 'roaring', 'howling', 'singing', 'humming', 'whistling', 'dancing', 'jumping', 'leaping', 'bouncing', 'skipping', 'hopping', 'running', 'jogging', 'walking', 'strolling', 'wandering', 'exploring', 'discovering', 'finding', 'locating', 'spotting', 'noticing', 'observing', 'watching', 'seeing', 'viewing', 'looking', 'gazing', 'staring', 'glancing', 'peeking', 'glimpsing', 'catching', 'grabbing', 'holding', 'grasping', 'clutching', 'gripping', 'squeezing', 'hugging', 'embracing', 'cuddling', 'snuggling', 'nuzzling', 'kissing', 'pecking', 'smooching', 'licking', 'tasting', 'savoring', 'enjoying', 'relishing', 'delighting', 'reveling', 'basking', 'soaking', 'absorbing', 'drinking', 'sipping', 'gulping', 'swallowing', 'consuming', 'devouring', 'eating', 'munching', 'chewing', 'biting', 'nibbling', 'gnawing', 'crunching', 'chomping', 'slurping', 'sucking', 'licking', 'tasting', 'sampling', 'trying', 'testing', 'experimenting', 'exploring', 'investigating', 'researching', 'studying', 'learning', 'understanding', 'comprehending', 'grasping', 'realizing', 'recognizing', 'acknowledging', 'accepting', 'believing', 'trusting', 'having faith', 'hoping', 'wishing', 'dreaming', 'imagining', 'visualizing', 'picturing', 'envisioning', 'foreseeing', 'predicting', 'anticipating', 'expecting', 'awaiting', 'looking forward', 'eager', 'excited', 'thrilled', 'delighted', 'pleased', 'happy', 'joyful', 'cheerful', 'merry', 'jolly', 'gleeful', 'giddy', 'bubbly', 'perky', 'upbeat', 'positive', 'optimistic', 'hopeful', 'confident', 'assured', 'certain', 'sure', 'convinced', 'determined', 'resolved', 'decided', 'committed', 'dedicated', 'devoted', 'loyal', 'faithful', 'true', 'honest', 'sincere', 'genuine', 'authentic', 'real', 'natural', 'organic', 'pure', 'clean', 'fresh', 'new', 'young', 'youthful', 'vibrant', 'lively', 'energetic', 'dynamic', 'active', 'busy', 'productive', 'efficient', 'effective', 'successful', 'prosperous', 'wealthy', 'rich', 'abundant', 'plentiful', 'ample', 'sufficient', 'enough', 'plenty', 'lots', 'many', 'numerous', 'countless', 'infinite', 'endless', 'limitless', 'boundless', 'vast', 'huge', 'enormous', 'gigantic', 'massive', 'colossal', 'tremendous', 'immense', 'great', 'big', 'large', 'wide', 'broad', 'extensive', 'comprehensive', 'complete', 'full', 'total', 'entire', 'whole', 'all', 'every', 'each', 'individual', 'personal', 'private', 'intimate', 'close', 'near', 'nearby', 'adjacent', 'next', 'following', 'subsequent', 'later', 'future', 'upcoming', 'coming', 'approaching', 'nearing', 'arriving', 'reaching', 'getting', 'obtaining', 'acquiring', 'gaining', 'earning', 'winning', 'achieving', 'accomplishing', 'completing', 'finishing', 'ending', 'concluding', 'closing', 'shutting', 'stopping', 'pausing', 'resting', 'relaxing', 'calming', 'soothing', 'comforting', 'consoling', 'reassuring', 'encouraging', 'supporting', 'helping', 'assisting', 'aiding', 'serving', 'providing', 'giving', 'offering', 'presenting', 'showing', 'displaying', 'exhibiting', 'demonstrating', 'proving', 'confirming', 'verifying', 'validating', 'authenticating', 'certifying', 'guaranteeing', 'ensuring', 'securing', 'protecting', 'defending', 'guarding', 'shielding', 'covering', 'hiding', 'concealing', 'masking', 'disguising', 'camouflaging', 'blending', 'mixing', 'combining', 'merging', 'joining', 'connecting', 'linking', 'attaching', 'fastening', 'binding', 'tying', 'knotting', 'weaving', 'braiding', 'twisting', 'turning', 'rotating', 'spinning', 'whirling', 'swirling', 'circling', 'revolving', 'orbiting', 'cycling', 'repeating', 'recurring', 'returning', 'coming back', 'revisiting', 'reviewing', 'reconsidering', 'rethinking', 'reflecting', 'pondering', 'contemplating', 'meditating', 'concentrating', 'focusing', 'centering', 'balancing', 'stabilizing', 'steadying', 'calming', 'quieting', 'silencing', 'hushing', 'whispering', 'murmuring', 'muttering', 'mumbling', 'speaking', 'talking', 'chatting', 'conversing', 'discussing', 'debating', 'arguing', 'disagreeing', 'opposing', 'resisting', 'fighting', 'battling', 'struggling', 'striving', 'trying', 'attempting', 'endeavoring', 'working', 'laboring', 'toiling', 'slaving', 'grinding', 'pushing', 'pulling', 'dragging', 'carrying', 'lifting', 'raising', 'elevating', 'boosting', 'increasing', 'growing', 'expanding', 'extending', 'stretching', 'reaching', 'touching', 'feeling', 'sensing', 'perceiving', 'noticing', 'observing', 'watching', 'monitoring', 'tracking', 'following', 'pursuing', 'chasing', 'hunting', 'searching', 'seeking', 'looking', 'finding', 'discovering', 'uncovering', 'revealing', 'exposing', 'showing', 'displaying', 'presenting', 'introducing', 'welcoming', 'greeting', 'meeting', 'encountering', 'facing', 'confronting', 'challenging', 'daring', 'risking', 'gambling', 'betting', 'wagering', 'investing', 'spending', 'paying', 'buying', 'purchasing', 'acquiring', 'obtaining', 'getting', 'receiving', 'accepting', 'taking', 'grabbing', 'seizing', 'capturing', 'catching', 'trapping', 'snaring', 'ensnaring', 'entangling', 'involving', 'including', 'incorporating', 'integrating', 'combining', 'merging', 'blending', 'mixing', 'stirring', 'shaking', 'vibrating', 'oscillating', 'fluctuating', 'varying', 'changing', 'altering', 'modifying', 'adjusting', 'adapting', 'accommodating', 'fitting', 'suiting', 'matching', 'coordinating', 'synchronizing', 'timing', 'scheduling', 'planning', 'organizing', 'arranging', 'preparing', 'readying', 'setting up', 'establishing', 'founding', 'creating', 'making', 'building', 'constructing', 'assembling', 'putting together', 'compiling', 'collecting', 'gathering', 'accumulating', 'amassing', 'stockpiling', 'hoarding', 'saving', 'storing', 'keeping', 'maintaining', 'preserving', 'conserving', 'protecting', 'safeguarding', 'securing', 'defending', 'guarding', 'watching over', 'looking after', 'caring for', 'tending', 'nurturing', 'fostering', 'cultivating', 'developing', 'growing', 'raising', 'breeding', 'training', 'teaching', 'educating', 'instructing', 'coaching', 'mentoring', 'guiding', 'leading', 'directing', 'managing', 'supervising', 'overseeing', 'monitoring', 'controlling', 'regulating', 'governing', 'ruling', 'commanding', 'ordering', 'demanding', 'requiring', 'needing', 'wanting', 'desiring', 'craving', 'longing', 'yearning', 'pining', 'aching', 'hurting', 'suffering', 'enduring', 'tolerating', 'bearing', 'withstanding', 'surviving', 'living', 'existing', 'being', 'staying', 'remaining', 'continuing', 'persisting', 'persevering', 'enduring', 'lasting', 'surviving', 'thriving', 'flourishing', 'prospering', 'succeeding', 'winning', 'triumphing', 'conquering', 'overcoming', 'defeating', 'beating', 'surpassing', 'exceeding', 'outperforming', 'outdoing', 'outshining', 'outmatching', 'outplaying', 'outwitting', 'outsmarting', 'outmaneuvering', 'outrunning', 'outpacing', 'outworking', 'excelling', 'shining', 'glowing', 'sparkling', 'twinkling', 'glittering', 'shimmering', 'gleaming', 'glistening', 'reflecting', 'mirroring', 'echoing', 'resonating', 'reverberating', 'vibrating', 'pulsating', 'throbbing', 'beating', 'pumping', 'flowing', 'streaming', 'rushing', 'gushing', 'pouring', 'spilling', 'overflowing', 'flooding', 'drowning', 'submerging', 'immersing', 'dipping', 'plunging', 'diving', 'jumping', 'leaping', 'bounding', 'springing', 'bouncing', 'rebounding', 'ricocheting', 'deflecting', 'reflecting', 'returning', 'coming back', 'revisiting', 'reviewing', 'reconsidering', 'rethinking', 'reflecting', 'pondering', 'contemplating', 'meditating', 'concentrating', 'focusing', 'centering', 'balancing', 'stabilizing', 'steadying', 'calming', 'soothing', 'relaxing', 'resting', 'sleeping', 'dreaming', 'imagining', 'visualizing', 'picturing', 'envisioning', 'foreseeing', 'predicting', 'anticipating', 'expecting', 'awaiting', 'hoping', 'wishing', 'praying', 'believing', 'trusting', 'having faith', 'confident', 'assured', 'certain', 'sure', 'convinced', 'determined', 'resolved', 'decided', 'committed', 'dedicated', 'devoted', 'loyal', 'faithful', 'true', 'honest', 'sincere', 'genuine', 'authentic', 'real', 'natural', 'organic', 'pure', 'clean', 'fresh', 'new', 'young', 'youthful', 'vibrant', 'lively', 'energetic', 'dynamic', 'active', 'busy', 'productive', 'efficient', 'effective', 'successful', 'prosperous', 'wealthy', 'rich', 'abundant', 'plentiful', 'ample', 'sufficient', 'enough', 'plenty', 'lots', 'many', 'numerous', 'countless', 'infinite', 'endless', 'limitless', 'boundless', 'vast', 'huge', 'enormous', 'gigantic', 'massive', 'colossal', 'tremendous', 'immense', 'great', 'big', 'large', 'wide', 'broad', 'extensive', 'comprehensive', 'complete', 'full', 'total', 'entire', 'whole'];
  const negativeWords = ['hurt', 'hate', 'jealous', 'angry', 'sad', 'upset', 'mad', 'frustrated', 'annoyed', 'irritated', 'disappointed', 'lonely', 'depressed', 'miserable', 'hopeless', 'worried', 'anxious', 'nervous', 'stressed', 'confused', 'afraid', 'scared', 'insecure', 'guilty', 'ashamed', 'embarrassed', 'bored', 'tired', 'sick', 'weak', 'fight', 'argue', 'enemy', 'attack', 'blame', 'insult', 'rude', 'mean', 'selfish', 'dishonest', 'liar', 'cheat', 'betrayal', 'unfair', 'broken', 'pain', 'loss', 'cry', 'shout', 'scream', 'kill', 'destroy', 'fail', 'lose', 'quit', 'reject', 'abandon', 'ignore', 'envy', 'jealousy', 'distrust', 'doubt', 'anger', 'hatred', 'resentment', 'sorry'];
  
  const hasPositive = positiveWords.some(word => text.toLowerCase().includes(word));
  const hasNegative = negativeWords.some(word => text.toLowerCase().includes(word));
  
  let mood = 'neutral';
  if (hasPositive) mood = 'happy';
  if (hasNegative) mood = 'sad';
  
  // Detect special backgrounds
  let background = 'default';
  if (text.toLowerCase().includes('pizza')) background = 'pizza';
  if (text.toLowerCase().includes('coffee')) background = 'coffee';
  if (text.toLowerCase().includes('cake')) background = 'party';
  
  res.json({
    original: text,
    translated: result,
    mood: mood,
    background: background
  });
});

app.listen(PORT, () => {
  console.log(`ðŸ§¸ Emoji Translator Server running on http://localhost:${PORT}`);
  console.log('Open your browser and go to the URL above to use the app!');
});